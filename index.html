<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KotoMusic Beta - AI Music Player</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üéµ</text></svg>">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background: linear-gradient(135deg, #0a0a1a 0%, #1a1a3a 100%);
            color: #fff;
            min-height: 100vh;
            padding: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .player-container {
            width: 100%;
            max-width: 1200px;
            background: rgba(20, 20, 40, 0.8);
            backdrop-filter: blur(15px);
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.5);
            overflow: hidden;
            border: 1px solid rgba(100, 100, 255, 0.1);
        }

        .player-header {
            background: linear-gradient(90deg, rgba(70, 50, 255, 0.2), rgba(120, 100, 255, 0.1));
            padding: 25px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid rgba(100, 100, 255, 0.2);
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .logo-icon {
            font-size: 32px;
            background: linear-gradient(135deg, #8a7cff, #6c5ce7);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
        }

        .logo-text {
            font-size: 28px;
            font-weight: 800;
            letter-spacing: 1px;
            background: linear-gradient(90deg, #8a7cff, #6c5ce7);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
        }

        .beta-badge {
            background: linear-gradient(135deg, #6c5ce7, #8a7cff);
            color: white;
            font-size: 12px;
            padding: 5px 12px;
            border-radius: 20px;
            font-weight: 700;
            margin-left: 10px;
        }

        .ai-badge {
            background: linear-gradient(135deg, #00c9ff, #92fe9d);
            color: #000;
            font-size: 11px;
            padding: 3px 8px;
            border-radius: 12px;
            font-weight: 700;
            margin-left: 5px;
        }

        .header-controls {
            display: flex;
            gap: 15px;
        }

        .header-btn {
            background: rgba(100, 100, 255, 0.15);
            border: 1px solid rgba(100, 100, 255, 0.3);
            color: #8a7cff;
            padding: 10px 20px;
            border-radius: 10px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            font-weight: 600;
            transition: all 0.3s;
        }

        .header-btn:hover {
            background: rgba(100, 100, 255, 0.25);
            transform: translateY(-2px);
        }

        .player-content {
            display: flex;
            min-height: 600px;
        }

        .player-sidebar {
            width: 30%;
            background: rgba(10, 10, 30, 0.7);
            padding: 25px;
            border-right: 1px solid rgba(100, 100, 255, 0.1);
            display: flex;
            flex-direction: column;
        }

        .player-main {
            width: 70%;
            padding: 30px;
            display: flex;
            flex-direction: column;
        }

        .upload-section {
            margin-bottom: 30px;
            padding: 20px;
            background: rgba(100, 100, 255, 0.05);
            border-radius: 15px;
            border: 2px dashed rgba(100, 100, 255, 0.3);
        }

        .upload-title {
            font-size: 18px;
            margin-bottom: 15px;
            color: #8a7cff;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .upload-area {
            position: relative;
            text-align: center;
            padding: 30px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .upload-area:hover {
            background: rgba(100, 100, 255, 0.1);
        }

        .upload-icon {
            font-size: 48px;
            color: #8a7cff;
            margin-bottom: 15px;
        }

        .upload-text {
            color: #aaa;
            margin-bottom: 10px;
        }

        .upload-note {
            font-size: 12px;
            color: #666;
        }

        #file-input {
            position: absolute;
            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
            opacity: 0;
            cursor: pointer;
        }

        .ai-info {
            background: rgba(0, 201, 255, 0.1);
            border: 1px solid rgba(0, 201, 255, 0.3);
            padding: 15px;
            border-radius: 10px;
            margin-top: 20px;
        }

        .ai-info-title {
            color: #00c9ff;
            font-size: 14px;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .ai-info-text {
            font-size: 13px;
            color: #88ddff;
            line-height: 1.5;
        }

        .playlist-title {
            font-size: 20px;
            font-weight: 700;
            margin: 25px 0 15px 0;
            color: #fff;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .playlist {
            list-style: none;
            flex: 1;
            overflow-y: auto;
            max-height: 300px;
        }

        .playlist li {
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 15px;
            cursor: pointer;
            transition: all 0.3s;
            background: rgba(255, 255, 255, 0.05);
        }

        .playlist li:hover {
            background: rgba(255, 255, 255, 0.1);
            transform: translateX(5px);
        }

        .playlist li.active {
            background: rgba(108, 92, 231, 0.2);
            border-left: 4px solid #6c5ce7;
        }

        .track-cover {
            width: 50px;
            height: 50px;
            border-radius: 8px;
            background: linear-gradient(135deg, #6c5ce7, #8a7cff);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            flex-shrink: 0;
        }

        .track-details {
            flex: 1;
            overflow: hidden;
        }

        .track-name {
            font-weight: 600;
            margin-bottom: 5px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .track-meta {
            font-size: 13px;
            color: #aaa;
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .track-ai {
            color: #00c9ff;
            font-weight: 600;
            font-size: 12px;
            background: rgba(0, 201, 255, 0.1);
            padding: 2px 6px;
            border-radius: 4px;
        }

        .track-duration {
            font-size: 14px;
            color: #aaa;
            flex-shrink: 0;
        }

        .now-playing {
            margin-bottom: 40px;
        }

        .now-playing-title {
            font-size: 14px;
            color: #8a7cff;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 15px;
        }

        .current-track {
            display: flex;
            align-items: center;
            gap: 25px;
        }

        .album-art {
            width: 200px;
            height: 200px;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.4);
            flex-shrink: 0;
            background: linear-gradient(135deg, #6c5ce7, #8a7cff);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 48px;
            color: white;
            transition: transform 0.5s;
        }

        .album-art:hover {
            transform: scale(1.03);
        }

        .track-info {
            flex: 1;
        }

        .track-title {
            font-size: 32px;
            font-weight: 800;
            margin-bottom: 10px;
            color: #fff;
        }

        .track-artist {
            font-size: 20px;
            color: #8a7cff;
            margin-bottom: 5px;
        }

        .track-album {
            font-size: 16px;
            color: #aaa;
            margin-bottom: 15px;
        }

        .ai-generated {
            display: inline-flex;
            align-items: center;
            gap: 5px;
            background: rgba(0, 201, 255, 0.2);
            color: #00c9ff;
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 700;
        }

        .player-controls {
            margin-top: auto;
        }

        .progress-area {
            margin-bottom: 25px;
        }

        .progress-bar {
            height: 8px;
            width: 100%;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            margin-bottom: 10px;
            cursor: pointer;
            position: relative;
        }

        .progress {
            height: 100%;
            width: 0%;
            background: linear-gradient(90deg, #6c5ce7, #8a7cff);
            border-radius: 10px;
            position: relative;
            transition: width 0.1s linear;
        }

        .progress::after {
            content: '';
            position: absolute;
            height: 16px;
            width: 16px;
            border-radius: 50%;
            background: #fff;
            right: -8px;
            top: 50%;
            transform: translateY(-50%);
            box-shadow: 0 0 15px rgba(108, 92, 231, 0.8);
            opacity: 0;
            transition: opacity 0.2s;
        }

        .progress-bar:hover .progress::after {
            opacity: 1;
        }

        .timer {
            display: flex;
            justify-content: space-between;
            font-size: 14px;
            color: #aaa;
        }

        .controls {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 30px;
            margin-bottom: 20px;
        }

        .control-btn {
            background: rgba(255, 255, 255, 0.1);
            border: none;
            color: #fff;
            font-size: 22px;
            cursor: pointer;
            width: 55px;
            height: 55px;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            transition: all 0.3s;
        }

        .control-btn:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: scale(1.1);
        }

        .play-pause {
            background: linear-gradient(135deg, #6c5ce7, #8a7cff);
            width: 70px;
            height: 70px;
            font-size: 28px;
            box-shadow: 0 10px 25px rgba(108, 92, 231, 0.4);
        }

        .play-pause:hover {
            transform: scale(1.15);
        }

        .volume-area {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-top: 20px;
        }

        .volume-icon {
            color: #8a7cff;
            font-size: 20px;
        }

        .volume-slider {
            flex: 1;
            height: 6px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            cursor: pointer;
        }

        .volume-percent {
            width: 70%;
            height: 100%;
            background: linear-gradient(90deg, #6c5ce7, #8a7cff);
            border-radius: 10px;
        }

        .waveform-container {
            height: 100px;
            margin: 30px 0;
            position: relative;
            overflow: hidden;
            border-radius: 10px;
            background: rgba(0, 0, 0, 0.2);
        }

        .waveform {
            width: 100%;
            height: 100%;
        }

        .player-footer {
            padding: 20px 30px;
            background: rgba(0, 0, 0, 0.3);
            border-top: 1px solid rgba(100, 100, 255, 0.1);
            font-size: 14px;
            color: #aaa;
            text-align: center;
        }

        .track-count {
            color: #8a7cff;
            font-weight: 700;
        }

        .status-indicator {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 14px;
        }

        .status-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: #00c9ff;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { opacity: 0.5; }
            50% { opacity: 1; }
            100% { opacity: 0.5; }
        }

        .pulse {
            animation: pulse 2s infinite;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }

        .modal-content {
            background: rgba(30, 30, 60, 0.95);
            padding: 30px;
            border-radius: 20px;
            width: 90%;
            max-width: 500px;
            border: 1px solid rgba(100, 100, 255, 0.3);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .modal-title {
            font-size: 24px;
            color: #8a7cff;
        }

        .close-modal {
            background: none;
            border: none;
            color: #aaa;
            font-size: 24px;
            cursor: pointer;
            transition: color 0.3s;
        }

        .close-modal:hover {
            color: #fff;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            color: #aaa;
        }

        .form-input {
            width: 100%;
            padding: 12px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(100, 100, 255, 0.3);
            border-radius: 8px;
            color: white;
            font-size: 16px;
        }

        .form-input:focus {
            outline: none;
            border-color: #8a7cff;
        }

        .form-buttons {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
            margin-top: 30px;
        }

        .btn {
            padding: 12px 24px;
            border-radius: 8px;
            border: none;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
        }

        .btn-primary {
            background: linear-gradient(135deg, #6c5ce7, #8a7cff);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(108, 92, 231, 0.4);
        }

        .btn-secondary {
            background: rgba(255, 255, 255, 0.1);
            color: white;
        }

        .btn-secondary:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .github-info {
            background: rgba(255, 255, 255, 0.05);
            padding: 15px;
            border-radius: 10px;
            margin-top: 20px;
            font-size: 13px;
            color: #aaa;
        }

        .github-info a {
            color: #8a7cff;
            text-decoration: none;
        }

        .github-info a:hover {
            text-decoration: underline;
        }

        @media (max-width: 900px) {
            .player-content {
                flex-direction: column;
            }
            
            .player-sidebar, .player-main {
                width: 100%;
            }
            
            .player-sidebar {
                max-height: 400px;
            }
            
            .current-track {
                flex-direction: column;
                text-align: center;
            }
            
            .album-art {
                width: 150px;
                height: 150px;
            }
            
            .track-title {
                font-size: 24px;
            }
            
            .track-artist {
                font-size: 18px;
            }
        }

        @media (max-width: 600px) {
            .player-header {
                flex-direction: column;
                gap: 15px;
                text-align: center;
            }
            
            .header-controls {
                width: 100%;
                justify-content: center;
            }
            
            .controls {
                gap: 15px;
            }
            
            .control-btn {
                width: 45px;
                height: 45px;
                font-size: 18px;
            }
            
            .play-pause {
                width: 60px;
                height: 60px;
                font-size: 24px;
            }
        }
    </style>
</head>
<body>
    <div class="player-container">
        <div class="player-header">
            <div class="logo">
                <i class="fas fa-robot logo-icon"></i>
                <div class="logo-text">KotoMusic<span class="beta-badge">BETA</span><span class="ai-badge">AI</span></div>
            </div>
            <div class="status-indicator">
                <div class="status-dot"></div>
                <span id="status-text">–ì–æ—Ç–æ–≤ –∫ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—é</span>
            </div>
            <div class="header-controls">
                <button class="header-btn" id="add-track-btn">
                    <i class="fas fa-plus"></i> –î–æ–±–∞–≤–∏—Ç—å —Ç—Ä–µ–∫
                </button>
                <button class="header-btn" id="import-btn">
                    <i class="fas fa-folder-open"></i> –ò–º–ø–æ—Ä—Ç
                </button>
            </div>
        </div>
        
        <div class="player-content">
            <div class="player-sidebar">
                <div class="upload-section">
                    <div class="upload-title">
                        <i class="fas fa-cloud-upload-alt"></i> –ó–∞–≥—Ä—É–∑–∫–∞ AI-–ø–µ—Å–µ–Ω
                    </div>
                    <div class="upload-area" id="upload-area">
                        <div class="upload-icon">
                            <i class="fas fa-music"></i>
                        </div>
                        <div class="upload-text">
                            –ü–µ—Ä–µ—Ç–∞—â–∏—Ç–µ —Ñ–∞–π–ª—ã –∏–ª–∏ –∫–ª–∏–∫–Ω–∏—Ç–µ –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏
                        </div>
                        <div class="upload-note">
                            –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è MP3, WAV, OGG, M4A
                        </div>
                        <input type="file" id="file-input" accept="audio/*" multiple>
                    </div>
                    
                    <div class="ai-info">
                        <div class="ai-info-title">
                            <i class="fas fa-brain"></i> AI –ì–µ–Ω–µ—Ä–∞—Ü–∏—è
                        </div>
                        <div class="ai-info-text">
                            –í–∞—à–∏ AI-—Ç—Ä–µ–∫–∏ –∏–∑ producer.ai —É–∂–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã. –î–æ–±–∞–≤–ª—è–π—Ç–µ –Ω–æ–≤—ã–µ —Ñ–∞–π–ª—ã –∏–ª–∏ —É–∫–∞–∑—ã–≤–∞–π—Ç–µ URL –¥–ª—è –ø—Ä–æ—Å–ª—É—à–∏–≤–∞–Ω–∏—è.
                        </div>
                    </div>

                    <div class="github-info">
                        <i class="fab fa-github"></i> –†–∞–∑–º–µ—â–µ–Ω–æ –Ω–∞ GitHub Pages
                        <div style="margin-top: 8px; font-size: 12px;">
                            –î–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–Ω–æ–ø–∫—É "–ò–º–ø–æ—Ä—Ç" –∏–ª–∏ –æ–±–ª–∞—Å—Ç—å –≤—ã—à–µ.
                        </div>
                    </div>
                </div>
                
                <div class="playlist-title">
                    <i class="fas fa-list-music"></i> AI –¢—Ä–µ–∫–∏ –æ—Ç kotkotenok43
                    <span id="track-count" class="track-count">(10)</span>
                </div>
                
                <ul class="playlist" id="playlist">
                    <!-- –ü–ª–µ–π–ª–∏—Å—Ç –±—É–¥–µ—Ç –∑–∞–ø–æ–ª–Ω–µ–Ω JavaScript -->
                </ul>
            </div>
            
            <div class="player-main">
                <div class="now-playing">
                    <div class="now-playing-title">–°–µ–π—á–∞—Å –∏–≥—Ä–∞–µ—Ç</div>
                    <div class="current-track">
                        <div class="album-art" id="album-art">
                            <i class="fas fa-robot"></i>
                        </div>
                        <div class="track-info">
                            <div class="track-title" id="track-title">–ó–∞–º–∫–Ω—É—Ç—ã–π –ö—Ä—É–≥</div>
                            <div class="track-artist" id="track-artist">kotkotenok43</div>
                            <div class="track-album" id="track-album">AI Boom Bap</div>
                            <span class="ai-generated">
                                <i class="fas fa-microchip"></i> FUZZ-2.0
                            </span>
                        </div>
                    </div>
                </div>
                
                <div class="waveform-container">
                    <canvas class="waveform" id="waveform"></canvas>
                </div>
                
                <div class="player-controls">
                    <div class="progress-area">
                        <div class="progress-bar" id="progress-bar">
                            <div class="progress" id="progress"></div>
                        </div>
                        <div class="timer">
                            <span class="current-time" id="current-time">0:00</span>
                            <span class="duration" id="duration">0:00</span>
                        </div>
                    </div>
                    
                    <div class="controls">
                        <button class="control-btn" id="prev-btn" title="–ü—Ä–µ–¥—ã–¥—É—â–∏–π —Ç—Ä–µ–∫">
                            <i class="fas fa-step-backward"></i>
                        </button>
                        <button class="control-btn play-pause" id="play-pause-btn" title="–í–æ—Å–ø—Ä–æ–∏–∑–≤–µ—Å—Ç–∏">
                            <i class="fas fa-play"></i>
                        </button>
                        <button class="control-btn" id="next-btn" title="–°–ª–µ–¥—É—é—â–∏–π —Ç—Ä–µ–∫">
                            <i class="fas fa-step-forward"></i>
                        </button>
                        <button class="control-btn" id="shuffle-btn" title="–ü–µ—Ä–µ–º–µ—à–∞—Ç—å">
                            <i class="fas fa-random"></i>
                        </button>
                        <button class="control-btn" id="repeat-btn" title="–ü–æ–≤—Ç–æ—Ä">
                            <i class="fas fa-redo"></i>
                        </button>
                    </div>
                    
                    <div class="volume-area">
                        <i class="fas fa-volume-up volume-icon" id="volume-icon"></i>
                        <div class="volume-slider" id="volume-slider">
                            <div class="volume-percent" id="volume-percent"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="player-footer">
            <div>KotoMusic Beta v2.0 | –°–ø–µ—Ü–∏–∞–ª—å–Ω–æ –¥–ª—è AI-–º—É–∑—ã–∫–∏</div>
            <div class="pulse" style="margin-top: 5px; font-size: 12px;">
                <i class="fas fa-brain"></i> –ó–∞–≥—Ä—É–∂–µ–Ω–æ <span id="footer-track-count">10</span> AI-—Ç—Ä–µ–∫–æ–≤ –æ—Ç kotkotenok43
            </div>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Ç—Ä–µ–∫–∞ -->
    <div class="modal" id="track-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">–î–æ–±–∞–≤–∏—Ç—å AI-—Ç—Ä–µ–∫</h2>
                <button class="close-modal" id="close-modal">&times;</button>
            </div>
            <form id="track-form">
                <div class="form-group">
                    <label class="form-label" for="track-name">–ù–∞–∑–≤–∞–Ω–∏–µ —Ç—Ä–µ–∫–∞</label>
                    <input type="text" id="track-name" class="form-input" placeholder="AI –ö–æ–º–ø–æ–∑–∏—Ü–∏—è #1" required>
                </div>
                <div class="form-group">
                    <label class="form-label" for="artist-name">–ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å / –ú–æ–¥–µ–ª—å –ò–ò</label>
                    <input type="text" id="artist-name" class="form-input" placeholder="–ù–µ–π—Ä–æ—Å–µ—Ç—å / Suno AI / Mubert" required>
                </div>
                <div class="form-group">
                    <label class="form-label" for="album-name">–ê–ª—å–±–æ–º / –ö–æ–ª–ª–µ–∫—Ü–∏—è</label>
                    <input type="text" id="album-name" class="form-input" placeholder="AI –ì–µ–Ω–µ—Ä–∞—Ü–∏—è 2024">
                </div>
                <div class="form-group">
                    <label class="form-label" for="file-url">URL –∞—É–¥–∏–æ—Ñ–∞–π–ª–∞</label>
                    <input type="text" id="file-url" class="form-input" placeholder="https://example.com/your-ai-track.mp3" required>
                </div>
                <div class="form-buttons">
                    <button type="button" class="btn btn-secondary" id="cancel-btn">–û—Ç–º–µ–Ω–∞</button>
                    <button type="submit" class="btn btn-primary">–î–æ–±–∞–≤–∏—Ç—å —Ç—Ä–µ–∫</button>
                </div>
            </form>
        </div>
    </div>

    <audio id="audio-player"></audio>

    <script>
        // –û—Å–Ω–æ–≤–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
        const audioPlayer = document.getElementById('audio-player');
        const playPauseBtn = document.getElementById('play-pause-btn');
        const prevBtn = document.getElementById('prev-btn');
        const nextBtn = document.getElementById('next-btn');
        const shuffleBtn = document.getElementById('shuffle-btn');
        const repeatBtn = document.getElementById('repeat-btn');
        const progressBar = document.getElementById('progress-bar');
        const progress = document.getElementById('progress');
        const currentTimeEl = document.getElementById('current-time');
        const durationEl = document.getElementById('duration');
        const volumeSlider = document.getElementById('volume-slider');
        const volumePercent = document.getElementById('volume-percent');
        const volumeIcon = document.getElementById('volume-icon');
        const playlistEl = document.getElementById('playlist');
        const uploadArea = document.getElementById('upload-area');
        const fileInput = document.getElementById('file-input');
        const addTrackBtn = document.getElementById('add-track-btn');
        const importBtn = document.getElementById('import-btn');
        const trackModal = document.getElementById('track-modal');
        const closeModal = document.getElementById('close-modal');
        const cancelBtn = document.getElementById('cancel-btn');
        const trackForm = document.getElementById('track-form');
        const waveformCanvas = document.getElementById('waveform');
        const trackCountEl = document.getElementById('track-count');
        const footerTrackCountEl = document.getElementById('footer-track-count');
        const statusText = document.getElementById('status-text');
        const albumArt = document.getElementById('album-art');
        
        // –°–æ—Å—Ç–æ—è–Ω–∏–µ –ø–ª–µ–µ—Ä–∞
        let currentTrackIndex = 0;
        let isPlaying = false;
        let isShuffled = false;
        let repeatMode = 'none'; // none, one, all
        let playlist = [];
        let audioContext;
        let analyser;
        let dataArray;
        let bufferLength;
        let canvasCtx;
        let waveformAnimationId;
        
        // –¶–≤–µ—Ç–∞ –¥–ª—è –æ–±–ª–æ–∂–µ–∫
        const coverColors = [
            'linear-gradient(135deg, #6c5ce7, #8a7cff)',
            'linear-gradient(135deg, #00c9ff, #92fe9d)',
            'linear-gradient(135deg, #ff6b6b, #ffa8a8)',
            'linear-gradient(135deg, #a29bfe, #74b9ff)',
            'linear-gradient(135deg, #fd79a8, #e84393)',
            'linear-gradient(135deg, #00b894, #55efc4)',
            'linear-gradient(135deg, #fdcb6e, #ffeaa7)',
            'linear-gradient(135deg, #636e72, #b2bec3)',
            'linear-gradient(135deg, #8e7cc3, #674ea7)',
            'linear-gradient(135deg, #e69138, #cc0000)'
        ];
        
        // –ò–∫–æ–Ω–∫–∏ –¥–ª—è –æ–±–ª–æ–∂–µ–∫
        const coverIcons = [
            'fas fa-robot', 'fas fa-brain', 'fas fa-microchip', 'fas fa-atom',
            'fas fa-bolt', 'fas fa-cloud', 'fas fa-code', 'fas fa-cube',
            'fas fa-globe', 'fas fa-infinity', 'fas fa-moon', 'fas fa-star',
            'fas fa-city', 'fas fa-paw', 'fas fa-guitar', 'fas fa-running',
            'fas fa-crown', 'fas fa-skull', 'fas fa-bolt', 'fas fa-street-view'
        ];

        // –í–∞—à–∏ AI-—Ç—Ä–µ–∫–∏ —Å producer.ai
        const initialPlaylist = [
            {
                id: 1,
                title: "–ó–∞–º–∫–Ω—É—Ç—ã–π –ö—Ä—É–≥",
                artist: "kotkotenok43",
                album: "AI Boom Bap",
                genre: "–†—É—Å—Å–∫–∏–π –æ–ª–¥—Å–∫—É–ª —Ö–∏–ø-—Ö–æ–ø",
                aiModel: "FUZZ-2.0",
                duration: "3:45",
                coverColor: coverColors[0],
                coverIcon: coverIcons[12],
                src: "" // –í—Å—Ç–∞–≤—å—Ç–µ –ø—Ä—è–º—É—é —Å—Å—ã–ª–∫—É –Ω–∞ MP3
            },
            {
                id: 2,
                title: "–ö–æ—Ç —É—á—ë–Ω—ã–π (—Ö–∏–ø-—Ö–æ–ø)",
                artist: "kotkotenok43",
                album: "Slavic AI Fusion",
                genre: "–•–∏–ø-—Ö–æ–ø —Å–æ Slavic folklore",
                aiModel: "FUZZ-2.0",
                duration: "3:20",
                coverColor: coverColors[1],
                coverIcon: coverIcons[13],
                src: "" // –í—Å—Ç–∞–≤—å—Ç–µ –ø—Ä—è–º—É—é —Å—Å—ã–ª–∫—É –Ω–∞ MP3
            },
            {
                id: 3,
                title: "–£—á—ë–Ω—ã–π –ö–æ—Ç (—Ä–æ–∫)",
                artist: "kotkotenok43",
                album: "AI Folk Rock",
                genre: "–§–æ–ª–∫-—Ä–æ–∫ —Å–æ Slavic mystique",
                aiModel: "FUZZ-2.0",
                duration: "4:15",
                coverColor: coverColors[2],
                coverIcon: coverIcons[14],
                src: "" // –í—Å—Ç–∞–≤—å—Ç–µ –ø—Ä—è–º—É—é —Å—Å—ã–ª–∫—É –Ω–∞ MP3
            },
            {
                id: 4,
                title: "Faster Than We Thought",
                artist: "kotkotenok43",
                album: "AI Pop-Rock",
                genre: "–ü–æ–ø-—Ä–æ–∫, –∏–Ω–¥–∏-—Ä–æ–∫",
                aiModel: "FUZZ-2.0",
                duration: "3:50",
                coverColor: coverColors[3],
                coverIcon: coverIcons[15],
                src: "" // –í—Å—Ç–∞–≤—å—Ç–µ –ø—Ä—è–º—É—é —Å—Å—ã–ª–∫—É –Ω–∞ MP3
            },
            {
                id: 5,
                title: "–ù–µ–ø–æ–±–µ–¥–∏–º–∞—è",
                artist: "kotkotenok43",
                album: "AI Club Hit",
                genre: "–ö–ª—É–±–Ω—ã–π —Ö–∏–ø-—Ö–æ–ø, –ø–æ–ø-—Ñ–∞–Ω–∫",
                aiModel: "FUZZ-2.0",
                duration: "3:30",
                coverColor: coverColors[4],
                coverIcon: coverIcons[16],
                src: "" // –í—Å—Ç–∞–≤—å—Ç–µ –ø—Ä—è–º—É—é —Å—Å—ã–ª–∫—É –Ω–∞ MP3
            },
            {
                id: 6,
                title: "–ñ—ë—Å—Ç–∫–∏–π —Ñ–æ–Ω–∫ LUNA",
                artist: "kotkotenok43",
                album: "AI Phonk",
                genre: "–•–∞—Ä–¥-—Ñ–æ–Ω–∫, Memphis style",
                aiModel: "FUZZ-1.1 Pro",
                duration: "2:55",
                coverColor: coverColors[5],
                coverIcon: coverIcons[17],
                src: "" // –í—Å—Ç–∞–≤—å—Ç–µ –ø—Ä—è–º—É—é —Å—Å—ã–ª–∫—É –Ω–∞ MP3
            },
            {
                id: 7,
                title: "–í–∞–π–± LUNA BALA",
                artist: "kotkotenok43",
                album: "AI EDM",
                genre: "–°–æ–≤—Ä–µ–º–µ–Ω–Ω–∞—è —ç–ª–µ–∫—Ç—Ä–æ–Ω–Ω–∞—è —Ç–∞–Ω—Ü–µ–≤–∞–ª—å–Ω–∞—è",
                aiModel: "FUZZ-1.1 Pro",
                duration: "3:40",
                coverColor: coverColors[6],
                coverIcon: coverIcons[18],
                src: "" // –í—Å—Ç–∞–≤—å—Ç–µ –ø—Ä—è–º—É—é —Å—Å—ã–ª–∫—É –Ω–∞ MP3
            },
            {
                id: 8,
                title: "Pulse",
                artist: "kotkotenok43",
                album: "AI EDM",
                genre: "EDM, –∫–ª—É–±–Ω–∞—è –º—É–∑—ã–∫–∞",
                aiModel: "FUZZ-1.0",
                duration: "3:25",
                coverColor: coverColors[7],
                coverIcon: coverIcons[19],
                src: "" // –í—Å—Ç–∞–≤—å—Ç–µ –ø—Ä—è–º—É—é —Å—Å—ã–ª–∫—É –Ω–∞ MP3
            },
            {
                id: 9,
                title: "System Overload",
                artist: "kotkotenok43",
                album: "AI Phonk",
                genre: "–§–æ–Ω–∫, –∞–≥—Ä–µ—Å—Å–∏–≤–Ω—ã–π —Ä—ç–ø",
                aiModel: "FUZZ-1.1 Pro",
                duration: "3:10",
                coverColor: coverColors[8],
                coverIcon: coverIcons[3],
                src: "" // –í—Å—Ç–∞–≤—å—Ç–µ –ø—Ä—è–º—É—é —Å—Å—ã–ª–∫—É –Ω–∞ MP3
            },
            {
                id: 10,
                title: "–†–∞–π–æ–Ω",
                artist: "kotkotenok43",
                album: "AI Russian Rap",
                genre: "–†—É—Å—Å–∫–∏–π —Ä—ç–ø, —Ç—ë–º–Ω—ã–π —Ç—Ä—ç–ø",
                aiModel: "FUZZ-1.1 Pro",
                duration: "3:50",
                coverColor: coverColors[9],
                coverIcon: coverIcons[19],
                src: "" // –í—Å—Ç–∞–≤—å—Ç–µ –ø—Ä—è–º—É—é —Å—Å—ã–ª–∫—É –Ω–∞ MP3
            }
        ];
        
        // –ó–∞–≥—Ä—É–∑–∫–∞ –ø–ª–µ–π–ª–∏—Å—Ç–∞ –∏–∑ localStorage –∏–ª–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        function loadPlaylistFromStorage() {
            const savedPlaylist = localStorage.getItem('kotoMusicPlaylist');
            if (savedPlaylist) {
                playlist = JSON.parse(savedPlaylist);
            } else {
                playlist = [...initialPlaylist];
                localStorage.setItem('kotoMusicPlaylist', JSON.stringify(playlist));
            }
            updatePlaylistDisplay();
            if (playlist.length > 0) {
                loadTrack(0);
            }
        }
        
        // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø–ª–µ–π–ª–∏—Å—Ç–∞ –≤ localStorage
        function savePlaylistToStorage() {
            localStorage.setItem('kotoMusicPlaylist', JSON.stringify(playlist));
        }
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏ –≤–æ–ª–Ω—ã
        function initWaveform() {
            canvasCtx = waveformCanvas.getContext('2d');
            waveformCanvas.width = waveformCanvas.offsetWidth;
            waveformCanvas.height = waveformCanvas.offsetHeight;
            
            // –°–æ–∑–¥–∞–µ–º AudioContext –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–∏
            document.addEventListener('click', initAudioContext, { once: true });
        }
        
        function initAudioContext() {
            if (!audioContext) {
                audioContext = new (window.AudioContext || window.webkitAudioContext)();
                analyser = audioContext.createAnalyser();
                const source = audioContext.createMediaElementSource(audioPlayer);
                source.connect(analyser);
                analyser.connect(audioContext.destination);
                
                analyser.fftSize = 256;
                bufferLength = analyser.frequencyBinCount;
                dataArray = new Uint8Array(bufferLength);
                
                drawWaveform();
            }
        }
        
        // –û—Ç—Ä–∏—Å–æ–≤–∫–∞ –≤–æ–ª–Ω—ã
        function drawWaveform() {
            if (!analyser) {
                waveformAnimationId = requestAnimationFrame(drawWaveform);
                return;
            }
            
            analyser.getByteTimeDomainData(dataArray);
            
            canvasCtx.fillStyle = 'rgba(10, 10, 30, 0.2)';
            canvasCtx.fillRect(0, 0, waveformCanvas.width, waveformCanvas.height);
            
            if (isPlaying) {
                canvasCtx.lineWidth = 2;
                canvasCtx.strokeStyle = '#6c5ce7';
                canvasCtx.beginPath();
                
                const sliceWidth = waveformCanvas.width * 1.0 / bufferLength;
                let x = 0;
                
                for (let i = 0; i < bufferLength; i++) {
                    const v = dataArray[i] / 128.0;
                    const y = v * waveformCanvas.height / 2;
                    
                    if (i === 0) {
                        canvasCtx.moveTo(x, y);
                    } else {
                        canvasCtx.lineTo(x, y);
                    }
                    
                    x += sliceWidth;
                }
                
                canvasCtx.lineTo(waveformCanvas.width, waveformCanvas.height / 2);
                canvasCtx.stroke();
            } else {
                // –°—Ç–∞—Ç–∏—á–Ω–∞—è –≤–æ–ª–Ω–∞ –≤ —Ä–µ–∂–∏–º–µ –ø–∞—É–∑—ã
                canvasCtx.lineWidth = 1;
                canvasCtx.strokeStyle = 'rgba(108, 92, 231, 0.3)';
                canvasCtx.beginPath();
                
                const sliceWidth = waveformCanvas.width * 1.0 / bufferLength;
                let x = 0;
                
                for (let i = 0; i < bufferLength; i++) {
                    const v = Math.sin(i * 0.2) * 0.5 + 0.5;
                    const y = v * waveformCanvas.height;
                    
                    if (i === 0) {
                        canvasCtx.moveTo(x, y);
                    } else {
                        canvasCtx.lineTo(x, y);
                    }
                    
                    x += sliceWidth;
                }
                
                canvasCtx.stroke();
            }
            
            waveformAnimationId = requestAnimationFrame(drawWaveform);
        }
        
        // –°–ª—É—á–∞–π–Ω—ã–π —Ü–≤–µ—Ç –¥–ª—è –æ–±–ª–æ–∂–∫–∏
        function getRandomCoverColor() {
            return coverColors[Math.floor(Math.random() * coverColors.length)];
        }
        
        // –°–ª—É—á–∞–π–Ω–∞—è –∏–∫–æ–Ω–∫–∞ –¥–ª—è –æ–±–ª–æ–∂–∫–∏
        function getRandomCoverIcon() {
            return coverIcons[Math.floor(Math.random() * coverIcons.length)];
        }
        
        // –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏
        function formatTime(seconds) {
            if (isNaN(seconds)) return "0:00";
            const min = Math.floor(seconds / 60);
            const sec = Math.floor(seconds % 60);
            return `${min}:${sec < 10 ? '0' : ''}${sec}`;
        }
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –ø–ª–µ–π–ª–∏—Å—Ç–∞
        function updatePlaylistDisplay() {
            playlistEl.innerHTML = '';
            
            playlist.forEach((track, index) => {
                const li = document.createElement('li');
                li.dataset.index = index;
                
                if (index === currentTrackIndex) {
                    li.classList.add('active');
                }
                
                li.innerHTML = `
                    <div class="track-cover" style="background: ${track.coverColor || getRandomCoverColor()}">
                        <i class="${track.coverIcon || getRandomCoverIcon()}"></i>
                    </div>
                    <div class="track-details">
                        <div class="track-name">${track.title}</div>
                        <div class="track-meta">
                            <span class="track-ai">${track.aiModel || 'AI'}</span>
                            <span>${track.artist}</span>
                        </div>
                    </div>
                    <div class="track-duration">${track.duration || '0:00'}</div>
                `;
                
                li.addEventListener('click', () => {
                    loadTrack(index);
                    playTrack();
                });
                
                playlistEl.appendChild(li);
            });
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Å—á–µ—Ç—á–∏–∫ —Ç—Ä–µ–∫–æ–≤
            trackCountEl.textContent = `(${playlist.length})`;
            footerTrackCountEl.textContent = playlist.length;
        }
        
        // –ó–∞–≥—Ä—É–∑–∫–∞ —Ç—Ä–µ–∫–∞
        function loadTrack(index) {
            if (playlist.length === 0) return;
            
            currentTrackIndex = index;
            const track = playlist[index];
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Ç–µ–∫—É—â–µ–º —Ç—Ä–µ–∫–µ
            document.getElementById('track-title').textContent = track.title;
            document.getElementById('track-artist').textContent = track.artist;
            document.getElementById('track-album').textContent = track.album || 'AI –ì–µ–Ω–µ—Ä–∞—Ü–∏—è';
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –æ–±–ª–æ–∂–∫—É
            albumArt.style.background = track.coverColor || getRandomCoverColor();
            albumArt.innerHTML = `<i class="${track.coverIcon || getRandomCoverIcon()}"></i>`;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å
            statusText.textContent = `–ó–∞–≥—Ä—É–∂–µ–Ω: ${track.title}`;
            
            // –ó–∞–≥—Ä—É–∂–∞–µ–º –∞—É–¥–∏–æ
            if (track.src) {
                audioPlayer.src = track.src;
                audioPlayer.load();
                
                // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –ø—Ä–æ–≥—Ä–µ—Å—Å
                progress.style.width = '0%';
                currentTimeEl.textContent = '0:00';
                durationEl.textContent = track.duration || '0:00';
                
                // –ö–æ–≥–¥–∞ –∞—É–¥–∏–æ –∑–∞–≥—Ä—É–∂–µ–Ω–æ, –æ–±–Ω–æ–≤–ª—è–µ–º –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
                audioPlayer.addEventListener('loadedmetadata', function onLoad() {
                    durationEl.textContent = formatTime(audioPlayer.duration);
                    
                    // –°–æ—Ö—Ä–∞–Ω—è–µ–º –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –≤ —Ç—Ä–µ–∫–µ
                    if (!track.duration || track.duration === "0:00") {
                        track.duration = formatTime(audioPlayer.duration);
                        savePlaylistToStorage();
                        updatePlaylistDisplay();
                    }
                    
                    audioPlayer.removeEventListener('loadedmetadata', onLoad);
                }, { once: true });
            } else {
                statusText.textContent = `–¢—Ä–µ–∫ "${track.title}" –Ω–µ –∏–º–µ–µ—Ç –∏—Å—Ç–æ—á–Ω–∏–∫–∞ –∞—É–¥–∏–æ`;
                audioPlayer.src = '';
            }
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –ø–ª–µ–π–ª–∏—Å—Ç
            updatePlaylistDisplay();
        }
        
        // –í–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ
        function playTrack() {
            if (playlist.length === 0) {
                statusText.textContent = "–ü–ª–µ–π–ª–∏—Å—Ç –ø—É—Å—Ç";
                return;
            }
            
            if (!playlist[currentTrackIndex].src) {
                statusText.textContent = "–£ —Ç–µ–∫—É—â–µ–≥–æ —Ç—Ä–µ–∫–∞ –Ω–µ—Ç –∏—Å—Ç–æ—á–Ω–∏–∫–∞ –∞—É–¥–∏–æ";
                return;
            }
            
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –∞—É–¥–∏–æ–∫–æ–Ω—Ç–µ–∫—Å—Ç –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–∏
            if (audioContext && audioContext.state === 'suspended') {
                audioContext.resume();
            }
            
            isPlaying = true;
            audioPlayer.play().then(() => {
                playPauseBtn.innerHTML = '<i class="fas fa-pause"></i>';
                playPauseBtn.title = "–ü–∞—É–∑–∞";
                statusText.textContent = `–ò–≥—Ä–∞–µ—Ç: ${playlist[currentTrackIndex].title}`;
            }).catch(error => {
                isPlaying = false;
                statusText.textContent = "–û—à–∏–±–∫–∞ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∏—Å—Ç–æ—á–Ω–∏–∫ –∞—É–¥–∏–æ.";
                console.error("Playback error:", error);
            });
        }
        
        // –ü–∞—É–∑–∞
        function pauseTrack() {
            isPlaying = false;
            audioPlayer.pause();
            playPauseBtn.innerHTML = '<i class="fas fa-play"></i>';
            playPauseBtn.title = "–í–æ—Å–ø—Ä–æ–∏–∑–≤–µ—Å—Ç–∏";
            statusText.textContent = `–ù–∞ –ø–∞—É–∑–µ: ${playlist[currentTrackIndex].title}`;
        }
        
        // –°–ª–µ–¥—É—é—â–∏–π —Ç—Ä–µ–∫
        function nextTrack() {
            if (playlist.length === 0) return;
            
            if (repeatMode === 'one') {
                audioPlayer.currentTime = 0;
                if (isPlaying) audioPlayer.play();
            } else {
                let newIndex;
                if (isShuffled) {
                    do {
                        newIndex = Math.floor(Math.random() * playlist.length);
                    } while (newIndex === currentTrackIndex && playlist.length > 1);
                } else {
                    newIndex = (currentTrackIndex + 1) % playlist.length;
                }
                
                loadTrack(newIndex);
                if (isPlaying) {
                    playTrack();
                }
            }
        }
        
        // –ü—Ä–µ–¥—ã–¥—É—â–∏–π —Ç—Ä–µ–∫
        function prevTrack() {
            if (playlist.length === 0) return;
            
            if (audioPlayer.currentTime > 3) {
                audioPlayer.currentTime = 0;
                return;
            }
            
            let newIndex;
            if (isShuffled) {
                do {
                    newIndex = Math.floor(Math.random() * playlist.length);
                } while (newIndex === currentTrackIndex && playlist.length > 1);
            } else {
                newIndex = (currentTrackIndex - 1 + playlist.length) % playlist.length;
            }
            
            loadTrack(newIndex);
            if (isPlaying) {
                playTrack();
            }
        }
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞
        function updateProgress() {
            const percent = (audioPlayer.currentTime / audioPlayer.duration) * 100 || 0;
            progress.style.width = `${percent}%`;
            currentTimeEl.textContent = formatTime(audioPlayer.currentTime);
        }
        
        // –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞
        function setProgress(e) {
            const width = this.clientWidth;
            const clickX = e.offsetX;
            const duration = audioPlayer.duration;
            
            if (duration) {
                audioPlayer.currentTime = (clickX / width) * duration;
            }
        }
        
        // –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –≥—Ä–æ–º–∫–æ—Å—Ç–∏
        function setVolume(e) {
            const width = this.clientWidth;
            const clickX = e.offsetX;
            const volume = Math.min(Math.max(clickX / width, 0), 1);
            
            audioPlayer.volume = volume;
            volumePercent.style.width = `${volume * 100}%`;
            
            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–∫–æ–Ω–∫–∏ –≥—Ä–æ–º–∫–æ—Å—Ç–∏
            if (volume === 0) {
                volumeIcon.className = 'fas fa-volume-mute volume-icon';
            } else if (volume < 0.5) {
                volumeIcon.className = 'fas fa-volume-down volume-icon';
            } else {
                volumeIcon.className = 'fas fa-volume-up volume-icon';
            }
        }
        
        // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Ä–µ–∂–∏–º–∞ –ø–æ–≤—Ç–æ—Ä–∞
        function toggleRepeat() {
            const modes = ['none', 'one', 'all'];
            const currentIndex = modes.indexOf(repeatMode);
            repeatMode = modes[(currentIndex + 1) % modes.length];
            
            // –í–∏–∑—É–∞–ª—å–Ω–∞—è –∏–Ω–¥–∏–∫–∞—Ü–∏—è
            repeatBtn.style.color = repeatMode === 'none' ? '#fff' : '#6c5ce7';
            repeatBtn.title = `–ü–æ–≤—Ç–æ—Ä: ${repeatMode === 'none' ? '–í—ã–∫–ª' : repeatMode === 'one' ? '–û–¥–∏–Ω —Ç—Ä–µ–∫' : '–í—Å–µ'}`;
        }
        
        // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Ä–µ–∂–∏–º–∞ –ø–µ—Ä–µ–º–µ—à–∏–≤–∞–Ω–∏—è
        function toggleShuffle() {
            isShuffled = !isShuffled;
            shuffleBtn.style.color = isShuffled ? '#6c5ce7' : '#fff';
            shuffleBtn.title = `–ü–µ—Ä–µ–º–µ—à–∞—Ç—å: ${isShuffled ? '–í–∫–ª' : '–í—ã–∫–ª'}`;
        }
        
        // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ç—Ä–µ–∫–∞ —á–µ—Ä–µ–∑ —Ñ–æ—Ä–º—É
        function addTrackFromForm(e) {
            e.preventDefault();
            
            const title = document.getElementById('track-name').value;
            const artist = document.getElementById('artist-name').value;
            const album = document.getElementById('album-name').value;
            const url = document.getElementById('file-url').value;
            
            if (!title || !artist || !url) {
                alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –∑–∞–ø–æ–ª–Ω–∏—Ç–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è');
                return;
            }
            
            const newTrack = {
                id: Date.now(),
                title,
                artist,
                album: album || 'AI –ì–µ–Ω–µ—Ä–∞—Ü–∏—è',
                genre: '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π —Ç—Ä–µ–∫',
                aiModel: '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å',
                duration: '0:00',
                url,
                coverColor: getRandomCoverColor(),
                coverIcon: getRandomCoverIcon()
            };
            
            playlist.push(newTrack);
            savePlaylistToStorage();
            updatePlaylistDisplay();
            
            // –ó–∞–∫—Ä—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –∏ —Å–±—Ä–∞—Å—ã–≤–∞–µ–º —Ñ–æ—Ä–º—É
            trackModal.style.display = 'none';
            trackForm.reset();
            statusText.textContent = `–î–æ–±–∞–≤–ª–µ–Ω –Ω–æ–≤—ã–π —Ç—Ä–µ–∫: ${title}`;
        }
        
        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–æ–≤
        function handleFileUpload(e) {
            const files = e.target.files || e.dataTransfer.files;
            
            if (files.length === 0) return;
            
            let uploadedCount = 0;
            
            for (let i = 0; i < files.length; i++) {
                const file = files[i];
                
                if (!file.type.startsWith('audio/')) {
                    alert(`–§–∞–π–ª "${file.name}" –Ω–µ —è–≤–ª—è–µ—Ç—Å—è –∞—É–¥–∏–æ—Ñ–∞–π–ª–æ–º`);
                    continue;
                }
                
                // –°–æ–∑–¥–∞–µ–º URL –¥–ª—è —Ñ–∞–π–ª–∞
                const url = URL.createObjectURL(file);
                
                // –ò–∑–≤–ª–µ–∫–∞–µ–º –∏–º—è —Ñ–∞–π–ª–∞ –±–µ–∑ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è
                const fileName = file.name.replace(/\.[^/.]+$/, "");
                
                const newTrack = {
                    id: Date.now() + i,
                    title: fileName || `AI –ö–æ–º–ø–æ–∑–∏—Ü–∏—è ${playlist.length + 1}`,
                    artist: '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å',
                    album: '–ó–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–µ —Ç—Ä–µ–∫–∏',
                    genre: '–õ–æ–∫–∞–ª—å–Ω—ã–π —Ñ–∞–π–ª',
                    aiModel: '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å',
                    duration: '0:00',
                    src: url,
                    coverColor: getRandomCoverColor(),
                    coverIcon: getRandomCoverIcon(),
                    file: file
                };
                
                playlist.push(newTrack);
                uploadedCount++;
            }
            
            savePlaylistToStorage();
            updatePlaylistDisplay();
            
            statusText.textContent = `–ó–∞–≥—Ä—É–∂–µ–Ω–æ ${uploadedCount} —Ç—Ä–µ–∫(–æ–≤)`;
            
            // –ï—Å–ª–∏ —ç—Ç–æ –ø–µ—Ä–≤—ã–π —Ç—Ä–µ–∫, –∑–∞–≥—Ä—É–∂–∞–µ–º –µ–≥–æ
            if (playlist.length === uploadedCount) {
                loadTrack(0);
            }
            
            // –°–±—Ä–∞—Å—ã–≤–∞–µ–º input
            fileInput.value = '';
        }
        
        // Drag and drop
        function handleDragOver(e) {
            e.preventDefault();
            uploadArea.style.background = 'rgba(100, 100, 255, 0.2)';
        }
        
        function handleDragLeave(e) {
            e.preventDefault();
            uploadArea.style.background = '';
        }
        
        function handleDrop(e) {
            e.preventDefault();
            uploadArea.style.background = '';
            handleFileUpload(e);
        }
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø–ª–µ–µ—Ä–∞
        function initPlayer() {
            // –ó–∞–≥—Ä—É–∂–∞–µ–º –ø–ª–µ–π–ª–∏—Å—Ç
            loadPlaylistFromStorage();
            
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—é
            initWaveform();
            
            // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –≥—Ä–æ–º–∫–æ—Å—Ç—å –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
            audioPlayer.volume = 0.7;
            volumePercent.style.width = '70%';
            
            // –°–æ–±—ã—Ç–∏—è –∞—É–¥–∏–æ
            audioPlayer.addEventListener('timeupdate', updateProgress);
            audioPlayer.addEventListener('ended', nextTrack);
            audioPlayer.addEventListener('error', () => {
                statusText.textContent = "–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∞—É–¥–∏–æ. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ URL –∏–ª–∏ —Ñ–∞–π–ª.";
            });
            
            // –°–æ–±—ã—Ç–∏—è –∫–Ω–æ–ø–æ–∫
            playPauseBtn.addEventListener('click', () => {
                if (isPlaying) {
                    pauseTrack();
                } else {
                    playTrack();
                }
            });
            
            nextBtn.addEventListener('click', nextTrack);
            prevBtn.addEventListener('click', prevTrack);
            shuffleBtn.addEventListener('click', toggleShuffle);
            repeatBtn.addEventListener('click', toggleRepeat);
            
            // –°–æ–±—ã—Ç–∏—è –ø—Ä–æ–≥—Ä–µ—Å—Å–∞
            progressBar.addEventListener('click', setProgress);
            
            // –°–æ–±—ã—Ç–∏—è –≥—Ä–æ–º–∫–æ—Å—Ç–∏
            volumeSlider.addEventListener('click', setVolume);
            
            // –°–æ–±—ã—Ç–∏—è –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–æ–≤
            fileInput.addEventListener('change', handleFileUpload);
            uploadArea.addEventListener('dragover', handleDragOver);
            uploadArea.addEventListener('dragleave', handleDragLeave);
            uploadArea.addEventListener('drop', handleDrop);
            
            // –°–æ–±—ã—Ç–∏—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
            addTrackBtn.addEventListener('click', () => {
                trackModal.style.display = 'flex';
            });
            
            importBtn.addEventListener('click', () => {
                fileInput.click();
            });
            
            closeModal.addEventListener('click', () => {
                trackModal.style.display = 'none';
            });
            
            cancelBtn.addEventListener('click', () => {
                trackModal.style.display = 'none';
                trackForm.reset();
            });
            
            trackForm.addEventListener('submit', addTrackFromForm);
            
            // –ì–æ—Ä—è—á–∏–µ –∫–ª–∞–≤–∏—à–∏
            document.addEventListener('keydown', (e) => {
                // –ü—Ä–æ–ø—É—Å–∫–∞–µ–º, –µ—Å–ª–∏ —Ñ–æ–∫—É—Å –≤ –ø–æ–ª–µ –≤–≤–æ–¥–∞
                if (e.target.tagName === 'INPUT') return;
                
                switch(e.code) {
                    case 'Space':
                        e.preventDefault();
                        if (isPlaying) {
                            pauseTrack();
                        } else {
                            playTrack();
                        }
                        break;
                    case 'ArrowRight':
                        if (e.ctrlKey || e.metaKey) {
                            e.preventDefault();
                            nextTrack();
                        }
                        break;
                    case 'ArrowLeft':
                        if (e.ctrlKey || e.metaKey) {
                            e.preventDefault();
                            prevTrack();
                        }
                        break;
                    case 'KeyL':
                        if (e.ctrlKey || e.metaKey) {
                            e.preventDefault();
                            toggleRepeat();
                        }
                        break;
                    case 'KeyS':
                        if (e.ctrlKey || e.metaKey) {
                            e.preventDefault();
                            toggleShuffle();
                        }
                        break;
                }
            });
            
            // –ê–¥–∞–ø—Ç–∞—Ü–∏—è —Ä–∞–∑–º–µ—Ä–∞ canvas –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –æ–∫–Ω–∞
            window.addEventListener('resize', () => {
                waveformCanvas.width = waveformCanvas.offsetWidth;
                waveformCanvas.height = waveformCanvas.offsetHeight;
            });
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
            statusText.textContent = "–ì–æ—Ç–æ–≤ –∫ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—é";
        }
        
        // –ó–∞–ø—É—Å–∫ –ø–ª–µ–µ—Ä–∞ –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        window.addEventListener('DOMContentLoaded', initPlayer);
        
        // –û—á–∏—Å—Ç–∫–∞ –ø—Ä–∏ –∑–∞–∫—Ä—ã—Ç–∏–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        window.addEventListener('beforeunload', () => {
            if (waveformAnimationId) {
                cancelAnimationFrame(waveformAnimationId);
            }
            
            // –û—Å–≤–æ–±–æ–∂–¥–∞–µ–º URL –æ–±—ä–µ–∫—Ç–æ–≤
            playlist.forEach(track => {
                if (track.src && track.src.startsWith('blob:')) {
                    URL.revokeObjectURL(track.src);
                }
            });
        });
    </script>
</body>
</html>
